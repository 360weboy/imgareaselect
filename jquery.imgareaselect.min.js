/*! imgareaselect 1.0 */ (function(e){function t(){return e("<div/>")}var o=Math.abs,i=Math.max,n=Math.min,s=Math.round;e.imgAreaSelect=function(c,a){function d(e){return e+pt.left-yt.left}function r(e){return e+pt.top-yt.top}function u(e){return e-pt.left+yt.left}function h(e){return e-pt.top+yt.top}function l(e){return i(e.pageX||0,m(e).x)-yt.left}function f(e){return i(e.pageY||0,m(e).y)-yt.top}function m(e){var t=e.originalEvent||{};return t.touches&&t.touches.length?{x:t.touches[0].pageX,y:t.touches[0].pageY}:{x:0,y:0}}function p(e){var t=e||$,o=e||q;return{x1:s(xt.x1*t),y1:s(xt.y1*o),x2:s(xt.x2*t),y2:s(xt.y2*o),width:s(xt.x2*t)-s(xt.x1*t),height:s(xt.y2*o)-s(xt.y1*o)}}function y(e,t,o,i,n){var c=n||$,a=n||q;xt={x1:s(e/c||0),y1:s(t/a||0),x2:s(o/c||0),y2:s(i/a||0)},xt.width=xt.x2-xt.x1,xt.height=xt.y2-xt.y1}function g(){rt.width()&&(pt={left:s(rt.offset().left),top:s(rt.offset().top)},j=rt.innerWidth(),D=rt.innerHeight(),pt.top+=rt.outerHeight()-D>>1,pt.left+=rt.outerWidth()-j>>1,Q=s(a.minWidth/$)||0,F=s(a.minHeight/q)||0,G=s(n(a.maxWidth/$||1<<24,j)),J=s(n(a.maxHeight/q||1<<24,D)),"1.3.2"!=e().jquery||"fixed"!=vt||wt.getBoundingClientRect||(pt.top+=i(document.body.scrollTop,wt.scrollTop),pt.left+=i(document.body.scrollLeft,wt.scrollLeft)),yt=/absolute|relative/.test(R.css("position"))?{left:s(R.offset().left)-R.scrollLeft(),top:s(R.offset().top)-R.scrollTop()}:"fixed"==vt?{left:e(document).scrollLeft(),top:e(document).scrollTop()}:{left:0,top:0},L=d(0),O=r(0),(xt.x2>j||xt.y2>D)&&A())}function v(t){if(V){switch(ut.css({left:d(xt.x1),top:r(xt.y1)}).add(ht).width(ct=xt.width).height(at=xt.height),ht.add(lt).add(mt).css({left:0,top:0}),lt.width(i(ct-lt.outerWidth()+lt.innerWidth(),0)).height(i(at-lt.outerHeight()+lt.innerHeight(),0)),e(ft[0]).css({left:L,top:O,width:xt.x1,height:D}),e(ft[1]).css({left:L+xt.x1,top:O,width:ct,height:xt.y1}),e(ft[2]).css({left:L+xt.x2,top:O,width:j-xt.x2,height:D}),e(ft[3]).css({left:L+xt.x1,top:O+xt.y2,width:ct,height:D-xt.y2}),ct-=mt.outerWidth(),at-=mt.outerHeight(),mt.length){case 8:e(mt[4]).css({left:ct>>1}),e(mt[5]).css({left:ct,top:at>>1}),e(mt[6]).css({left:ct>>1,top:at}),e(mt[7]).css({top:at>>1});case 4:mt.slice(1,3).css({left:ct}),mt.slice(2,4).css({top:at})}t!==!1&&(e.imgAreaSelect.keyPress!=St&&e(document).unbind(e.imgAreaSelect.keyPress,e.imgAreaSelect.onKeyPress),a.keys&&e(document)[e.imgAreaSelect.keyPress](e.imgAreaSelect.onKeyPress=St))}}function x(e){g(),v(e),Z=d(xt.x1),_=r(xt.y1),et=d(xt.x2),tt=r(xt.y2)}function w(e,t){a.fadeSpeed?e.fadeOut(a.fadeSpeed,t):e.hide()}function b(e){var t=u(l(e))-xt.x1,o=h(f(e))-xt.y1;dt||(g(),dt=!0,ut.one("mouseout",function(){dt=!1})),B="",a.resizable&&(a.resizeMargin>=o?B="n":o>=xt.height-a.resizeMargin&&(B="s"),a.resizeMargin>=t?B+="w":t>=xt.width-a.resizeMargin&&(B+="e")),ut.css("cursor",B?B+"-resize":a.movable?"move":"")}function S(){e("body").css("cursor",""),(a.autoHide||0==xt.width*xt.height)&&w(ut.add(ft),function(){e(this).hide()}),e(document).off("mousemove touchmove",P),ut.on("mousemove touchmove",b),a.onSelectEnd(c,p())}function z(t){return"mousedown"==t.type&&1!=t.which?!1:(b(t),g(),B?(e("body").css("cursor",B+"-resize"),Z=d(xt[/w/.test(B)?"x2":"x1"]),_=r(xt[/n/.test(B)?"y2":"y1"]),e(document).on("mousemove touchmove",P).one("mouseup touchend",S),ut.off("mousemove touchmove",b)):a.movable?(X=L+xt.x1-l(t),Y=O+xt.y1-f(t),ut.off("mousemove touchmove",b),e(document).on("mousemove touchmove",I).one("mouseup touchend",function(){a.onSelectEnd(c,p()),e(document).off("mousemove touchmove",I),ut.on("mousemove touchmove",b)})):rt.mousedown(t),!1)}function k(e){U&&(e?(et=i(L,n(L+j,Z+o(tt-_)*U*(et>Z||-1))),tt=s(i(O,n(O+D,_+o(et-Z)/U*(tt>_||-1)))),et=s(et)):(tt=i(O,n(O+D,_+o(et-Z)/U*(tt>_||-1))),et=s(i(L,n(L+j,Z+o(tt-_)*U*(et>Z||-1)))),tt=s(tt)))}function A(){Z=n(Z,L+j),_=n(_,O+D),Q>o(et-Z)&&(et=Z-Q*(Z>et||-1),L>et?Z=L+Q:et>L+j&&(Z=L+j-Q)),F>o(tt-_)&&(tt=_-F*(_>tt||-1),O>tt?_=O+F:tt>O+D&&(_=O+D-F)),et=i(L,n(et,L+j)),tt=i(O,n(tt,O+D)),k(o(et-Z)<o(tt-_)*U),o(et-Z)>G&&(et=Z-G*(Z>et||-1),k()),o(tt-_)>J&&(tt=_-J*(_>tt||-1),k(!0)),xt={x1:u(n(Z,et)),x2:u(i(Z,et)),y1:h(n(_,tt)),y2:h(i(_,tt)),width:o(et-Z),height:o(tt-_)},v(),a.onSelectChange(c,p())}function P(e){return et=/w|e|^$/.test(B)||U?l(e):d(xt.x2),tt=/n|s|^$/.test(B)||U?f(e):r(xt.y2),A(),!1}function C(t,o){et=(Z=t)+xt.width,tt=(_=o)+xt.height,e.extend(xt,{x1:u(Z),y1:h(_),x2:u(et),y2:h(tt)}),v(),a.onSelectChange(c,p())}function I(e){return Z=i(L,n(X+l(e),L+j-xt.width)),_=i(O,n(Y+f(e),O+D-xt.height)),C(Z,_),e.preventDefault(),!1}function K(){e(document).off("mousemove touchmove",K),g(),et=Z,tt=_,A(),B="",ft.is(":visible")||ut.add(ft).hide().fadeIn(a.fadeSpeed||0),V=!0,e(document).off("mouseup touchend",N).on("mousemove touchmove",P).one("mouseup touchend",S),ut.off("mousemove touchmove",b),a.onSelectStart(c,p())}function N(){e(document).off("mousemove touchmove",K).off("mouseup touchend",N),w(ut.add(ft)),y(u(Z),h(_),u(Z),h(_)),this instanceof e.imgAreaSelect||(a.onSelectChange(c,p()),a.onSelectEnd(c,p()))}function H(t){return 1!=t.which||ft.is(":animated")?!1:(g(),X=Z=l(t),Y=_=f(t),e(document).on({"mousemove touchmove":K,"mouseup touchend":N}),!1)}function M(){x(!1)}function E(){T=!0,W(a=e.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},a)),ut.add(ft).css({visibility:""}),a.show&&(V=!0,g(),v(),ut.add(ft).hide().fadeIn(a.fadeSpeed||0)),setTimeout(function(){a.onInit(c,p())},0)}function W(o){if(o.parent&&(R=e(o.parent)).append(ut).append(ft),e.extend(a,o),g(),null!=o.handles){for(mt.remove(),mt=e([]),nt=o.handles?"corners"==o.handles?4:8:0;nt--;)mt=mt.add(t());mt.addClass(a.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:gt+1||1}),!parseInt(mt.css("width"))>=0&&mt.width(5).height(5)}for($=a.imageWidth/j||1,q=a.imageHeight/D||1,null!=o.x1&&(y(o.x1,o.y1,o.x2,o.y2),o.show=!o.hide),o.keys&&(a.keys=e.extend({shift:1,ctrl:"resize"},o.keys)),ft.addClass(a.classPrefix+"-outer"),ht.addClass(a.classPrefix+"-selection"),nt=0;4>nt++;)e(lt[nt-1]).addClass(a.classPrefix+"-border"+nt);ut.append(ht.add(lt)).append(mt),zt&&((st=(ft.css("filter")||"").match(/opacity=(\d+)/))&&ft.css("opacity",st[1]/100),(st=(lt.css("filter")||"").match(/opacity=(\d+)/))&&lt.css("opacity",st[1]/100)),o.hide?w(ut.add(ft)):o.show&&T&&(V=!0,ut.add(ft).fadeIn(a.fadeSpeed||0),x()),U=(it=(a.aspectRatio||"").split(/:/))[0]/it[1],rt.add(ft).unbind("mousedown",H),a.disable||a.enable===!1?(ut.off({"mousemove touchmove":b,"mousedown touchstart":z}),e(window).off("resize",M)):((a.enable||a.disable===!1)&&((a.resizable||a.movable)&&ut.on({"mousemove touchmove":b,"mousedown touchstart":z}),e(window).resize(M)),a.persistent||rt.add(ft).on("mousedown touchstart",H)),a.enable=a.disable=void 0}var T,L,O,j,D,R,X,Y,$,q,B,Q,F,G,J,U,V,Z,_,et,tt,ot,it,nt,st,ct,at,dt,rt=e(c),ut=t(),ht=t(),lt=t().add(t()).add(t()).add(t()),ft=t().add(t()).add(t()).add(t()),mt=e([]),pt={left:0,top:0},yt={left:0,top:0},gt=0,vt="absolute",xt={x1:0,y1:0,x2:0,y2:0,width:0,height:0},wt=document.documentElement,bt=navigator.userAgent,St=function(e){var t,o,s=a.keys,c=e.keyCode;if(t=isNaN(s.alt)||!e.altKey&&!e.originalEvent.altKey?!isNaN(s.ctrl)&&e.ctrlKey?s.ctrl:!isNaN(s.shift)&&e.shiftKey?s.shift:isNaN(s.arrows)?10:s.arrows:s.alt,"resize"==s.arrows||"resize"==s.shift&&e.shiftKey||"resize"==s.ctrl&&e.ctrlKey||"resize"==s.alt&&(e.altKey||e.originalEvent.altKey)){switch(c){case 37:t=-t;case 39:o=i(Z,et),Z=n(Z,et),et=i(o+t,Z),k();break;case 38:t=-t;case 40:o=i(_,tt),_=n(_,tt),tt=i(o+t,_),k(!0);break;default:return}A()}else switch(Z=n(Z,et),_=n(_,tt),c){case 37:C(i(Z-t,L),_);break;case 38:C(Z,i(_-t,O));break;case 39:C(Z+n(t,j-u(et)),_);break;case 40:C(Z,_+n(t,D-h(tt)));break;default:return}return!1};this.remove=function(){W({disable:!0}),ut.add(ft).remove()},this.getOptions=function(){return a},this.setOptions=W,this.getSelection=p,this.setSelection=y,this.cancelSelection=N,this.update=x;var zt=(/msie ([\w.]+)/i.exec(bt)||[])[1],kt=/webkit/i.test(bt)&&!/chrome/i.test(bt);for(ot=rt;ot.length;)gt=i(gt,isNaN(ot.css("z-index"))?gt:ot.css("z-index")),"fixed"==ot.css("position")&&(vt="fixed"),ot=ot.parent(":not(body)");gt=a.zIndex||gt,zt&&rt.attr("unselectable","on"),e.imgAreaSelect.keyPress=zt||kt?"keydown":"keypress",ut.add(ft).css({visibility:"hidden",position:vt,overflow:"hidden",zIndex:gt||"0"}),ut.css({zIndex:gt+2||2}),ht.add(lt).css({position:"absolute",fontSize:0}),c.complete||"complete"==c.readyState||!rt.is("img")?E():rt.one("load",E),!T&&zt&&zt>=7&&(c.src=c.src)},e.fn.imgAreaSelect=function(t){return t=t||{},this.each(function(){e(this).data("imgAreaSelect")?t.remove?(e(this).data("imgAreaSelect").remove(),e(this).removeData("imgAreaSelect")):e(this).data("imgAreaSelect").setOptions(t):t.remove||(void 0===t.enable&&void 0===t.disable&&(t.enable=!0),e(this).data("imgAreaSelect",new e.imgAreaSelect(this,t)))}),t.instance?e(this).data("imgAreaSelect"):this}})(jQuery);